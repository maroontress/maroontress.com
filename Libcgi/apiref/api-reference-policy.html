<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>APIリファレンスの記述ポリシー</title>
<link rel="stylesheet" type="text/css" href="api-reference-policy.css">
</head>
<body>
<p>このプロジェクトのAPIリファレンスの記述ポリシーを説明します。</p>


<hr>
<p class="section">オブジェクトの参照の引数</p>

<p>メソッド呼び出しで引数として渡すオブジェクトの参照には次のようなタイプがあります。</p>
<ul>
  <li>メソッド呼び出しの間だけ利用されるオブジェクトの参照</li>
  <li>メソッド呼び出しの後も利用されるオブジェクトの参照</li>
  <li>メソッド呼び出しの後は利用できないオブジェクトの参照</li>
</ul>

<p>それぞれのタイプによって、ドキュメントに記述される内容が次のように異なります。</p>

<dl>

<dt>メソッド呼び出しの間だけ利用されるオブジェクトの参照</dt>
<dd>
<p>オブジェクトへのアクセスはメソッド呼び出しの間にだけ発生し、呼び出しから戻った後はアクセスされません（もちろん、呼び出しによってオブジェクトは複製されたり参照カウントを増やされている可能性がありますが、そのことは呼び出し元が関知することではありません）。したがって、メソッド呼び出し後に、呼び出し元がオブジェクトを変更、解放しても、呼び出したメソッドのクラスやインスタンスに影響はありません。</p>

<p>オブジェクトへの参照が発生する期間がドキュメントに特に記述されない場合は、このタイプの参照になります。このタイプの参照であることをドキュメントに明記したい場合、次のようなスタイルで記述します。</p>
<ul>
  <li>「呼び出しから戻った後に<i>arg</i>が参照するオブジェクトを参照することはありません。」</li>
</ul>

<p>例: <tt>strlen(3)</tt></p>
</dd>


<dt>メソッド呼び出しの後も利用されるオブジェクトの参照</dt>
<dd>
<p>メソッド呼び出し後も、呼び出したメソッドのクラスやインスタンスがオブジェクトにアクセスします。ケースによっては、メソッド呼び出し後に呼び出し元がオブジェクトを操作することを制限したり、呼び出したメソッドのクラスやインスタンスがオブジェクトを解放することもあります。</p>

<p>オブジェクトへのアクセスが発生しなくなる操作や、オブジェクトへの参照が発生する期間について、次のようなスタイルでドキュメントに記述しなければなりません。オブジェクトの操作に制限がある場合や、オブジェクトが解放されてしまう場合は、それも併せて記述しなければなりません。</p>
<ul>
  <li>「...まで<i>arg</i>が参照するオブジェクトは有効でなければなりません。」</li>
  <li>「...まで<i>arg</i>が参照するオブジェクトに...してはなりません。」</li>
  <li>「...ときに<i>arg</i>が参照するオブジェクトはそのデストラクタで解放されます。」</li>
</ul>

<p>例: <tt>setvbuf(3)</tt>, <tt>pthread_attr_setstackaddr(3)</tt></p>
</dd>


<dt>メソッド呼び出しの後は利用できないオブジェクトの参照</dt>
<dd>
<p>メソッド呼び出し後は呼び出し元がオブジェクトにアクセスすることができなくなります。典型的な例はデストラクタです。戻り値などによってオブジェクトへのアクセスの可否が決まる場合もあります。</p>

<p>オブジェクトを参照できなくなってしまう条件を、次のようなスタイルでドキュメントに記述しなければなりません。</p>
<ul>
  <li>「呼び出し後は<i>arg</i>が参照するオブジェクトを参照してはなりません。」</li>
  <li>「戻り値が...の場合は<i>arg</i>が参照するオブジェクトを参照してはなりません。」</li>
</ul>

<p>例: <tt>free(3)</tt>, <tt>realloc(3)</tt></p>
</dd>
</dl>


<hr>
<p class="section">オブジェクトの参照の戻り値</p>

<p>メソッド呼び出しで戻り値として返すオブジェクトの参照には次のようなタイプがあります。</p>
<ul>
  <li>クラスやインスタンスが保持するオブジェクトの参照</li>
  <li>生成したオブジェクトの参照</li>
  <li>引数に与えられた配列オブジェクトの要素の参照</li>
</ul>

<p>それぞれのタイプによって、ドキュメントに記述される内容が次のように異なります。</p>

<dl>

<dt>クラスやインスタンスが保持するオブジェクトの参照</dt>
<dd>
<p>このタイプの参照は主に<tt>get</tt>系のメソッドによって返されます。取得したオブジェクトは、呼び出したメソッドのクラスまたはインスタンスが参照しています。取得したオブジェクトは呼び出し元による変更や解放などの操作が制限されているかもしれません。必要があれば、呼び出し元は取得したオブジェクトを複製しなければなりません。</p>

<p>取得したオブジェクトが有効な期間、制限を次のようなスタイルでドキュメントに記述しなければなりません。</p>
<ul>
  <li>「戻り値が参照するオブジェクトは...まで有効です。」</li>
  <li>「戻り値が参照するオブジェクトを...してはなりません。」</li>
</ul>

<p>例: 4.4BSDの<tt>fgetln(3)</tt></p>
</dd>

<dt>生成したオブジェクトの参照</dt>
<dd>
<p>このタイプの参照は主に<tt>create</tt>系のメソッドやコンストラクタによって返されます。呼び出したメソッドのクラスまたはインスタンスは生成したオブジェクトを参照していません（ただし、戻り値が参照するオブジェクトが自分を生成したインスタンスを参照していることがあり、その場合は別の制限が加わります）。呼び出し元は、戻り値が参照するオブジェクトが不要になったとき（を参照しなくなるとき）に、それを解放する必要があります。</p>

<p>生成したオブジェクトを解放する方法を次のようなスタイルでドキュメントに記述しなければなりません。</p>
<ul>
  <li>「戻り値が参照するオブジェクトは...で解放しなければなりません。」</li>
</ul>

<p>例: <tt>strdup(3)</tt></p>
</dd>


<dt>引数に与えられた配列オブジェクトの要素の参照</dt>
<dd>
<p>このタイプの参照は主に<tt>strchr(3)</tt>のような探索系のメソッドによって返されます（特に文字列は文字配列として同様に扱います）。引数の配列オブジェクトの要素を選択し、その要素の参照を返します。一般に、引数の型に<tt>const</tt>修飾子が指定されていても、戻り値には指定されません。</p>

<p>このタイプの参照は、次のようなスタイルでドキュメントに記述しなければなりません。</p>
<ul>
  <li>「戻り値は<i>arg</i>が参照するオブジェクトに含まれる要素の参照です。」</li>
</ul>

<p>例: <tt>strchr(3)</tt></p>
</dd>
</dl>


<hr>
<p class="section">クラスの初期化</p>

<p>主に<tt>staticInitialize</tt>系のメソッドで初期化します。環境によってはAPI利用者が明示的に呼び出す必要がないかもしれません（スタートアップコードが自動的に<tt>main</tt>よりも先に呼び出すため）。</p>

<p>ドキュメントには次のようなスタイルで記述しなければなりません。</p>
<ul>
  <li>「このクラスの他のメソッドを呼び出す前に少なくても1回呼び出す必要があります。このメソッドを複数回呼び出した場合、最初の呼び出し以外ではなにもしません。」</li>
</ul>


<hr>
<p class="section">実装上の都合で公開されるメソッド</p>

<p>ドキュメントには次のようなスタイルで記述しなければなりません。</p>
<ul>
  <li>「このメソッドは実装上の都合で公開されているので、アプリケーションは呼び出さないでください。」</li>
</ul>

</body>
</html>
